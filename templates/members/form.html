{% extends "base/base.html" %}
{% load static %}

{% block title %}{% if form.instance.id %}تعديل العضو{% else %}إضافة عضو جديد{% endif %} - GymPro{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="mb-4">
        <h2 class="fw-bold">
            {% if form.instance.id %}
                تعديل بيانات العضو: {{ form.instance.full_name }}
            {% else %}
                إضافة عضو جديد
            {% endif %}
        </h2>
    </div>

    <form method="post" enctype="multipart/form-data" class="was-validated">
        {% csrf_token %}

        <div class="row">
            <!-- Main Form -->
            <div class="col-lg-8">
                <!-- Personal Information Section -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-user text-primary ms-2"></i>
                            المعلومات الشخصية
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="fullName" class="form-label">الاسم الكامل *</label>
                                <input type="text" class="form-control" id="fullName" name="full_name" 
                                       value="{{ form.instance.full_name }}" required>
                                <div class="invalid-feedback">
                                    يرجى إدخال الاسم الكامل
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="phone" class="form-label">رقم الهاتف *</label>
                                <input type="tel" class="form-control" id="phone" name="phone" 
                                       value="{{ form.instance.phone }}" required>
                                <div class="invalid-feedback">
                                    يرجى إدخال رقم الهاتف
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="email" class="form-label">البريد الإلكتروني</label>
                                <input type="email" class="form-control" id="email" name="email" 
                                       value="{{ form.instance.email }}">
                            </div>

                            <div class="col-md-6">
                                <label for="gender" class="form-label">الجنس</label>
                                <select class="form-select" id="gender" name="gender">
                                    <option value="">اختر...</option>
                                    <option value="M" {% if form.instance.gender == 'M' %}selected{% endif %}>ذكر</option>
                                    <option value="F" {% if form.instance.gender == 'F' %}selected{% endif %}>أنثى</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="birthDate" class="form-label">تاريخ الميلاد</label>
                                <input type="date" class="form-control date-picker" id="birthDate" name="birth_date"
                                       value="{{ form.instance.birth_date|date:'Y-m-d' }}">
                            </div>

                            <div class="col-md-6">
                                <label for="address" class="form-label">العنوان</label>
                                <input type="text" class="form-control" id="address" name="address" 
                                       value="{{ form.instance.address }}">
                            </div>

                            <div class="col-12">
                                <label for="notes" class="form-label">ملاحظات صحية</label>
                                <textarea class="form-control" id="notes" name="health_notes" rows="3">{{ form.instance.health_notes }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Emergency Contact Section -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-phone text-secondary ms-2"></i>
                            معلومات الطوارئ
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="emergencyName" class="form-label">اسم جهة الاتصال</label>
                                <input type="text" class="form-control" id="emergencyName" name="emergency_contact_name" 
                                       value="{{ form.instance.emergency_contact_name }}">
                            </div>

                            <div class="col-md-6">
                                <label for="emergencyPhone" class="form-label">رقم الطوارئ</label>
                                <input type="tel" class="form-control" id="emergencyPhone" name="emergency_contact_phone" 
                                       value="{{ form.instance.emergency_contact_phone }}">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save ms-2"></i>
                        {% if form.instance.id %}تحديث{% else %}إضافة{% endif %}
                    </button>
                    <a href="{% url 'members:list' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-times ms-2"></i>إلغاء
                    </a>
                </div>
            </div>

            <!-- Sidebar - Photo Upload -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-image text-info ms-2"></i>
                            الصورة الشخصية
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            {% if form.instance.image %}
                                <img src="{{ form.instance.image.url }}" id="imagePreview" class="image-preview" alt="صورة العضو">
                            {% else %}
                                <div class="bg-light rounded p-4 mb-3" style="height: 150px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user" style="font-size: 3rem; color: #cbd5e1;"></i>
                                </div>
                                <img id="imagePreview" class="image-preview" style="display: none;" alt="معاينة">
                            {% endif %}
                        </div>

                        <div class="upload-area" id="uploadArea">
                            <input type="file" id="image" name="image" accept="image/*" class="d-none" 
                                   data-preview-id="imagePreview">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #cbd5e1;"></i>
                            <p class="mt-2 mb-0">اسحب الصورة هنا</p>
                            <small class="text-muted">أو انقر للاختيار</small>
                        </div>

                        <script>
                        document.getElementById('uploadArea').addEventListener('click', function() {
                            document.getElementById('image').click();
                        });

                        document.getElementById('uploadArea').addEventListener('dragover', function(e) {
                            e.preventDefault();
                            this.classList.add('active');
                        });

                        document.getElementById('uploadArea').addEventListener('dragleave', function() {
                            this.classList.remove('active');
                        });

                        document.getElementById('uploadArea').addEventListener('drop', function(e) {
                            e.preventDefault();
                            this.classList.remove('active');
                            document.getElementById('image').files = e.dataTransfer.files;
                            document.getElementById('image').dispatchEvent(new Event('change'));
                        });
                        </script>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}
